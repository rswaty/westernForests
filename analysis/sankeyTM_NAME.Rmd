---
title: "Sankey comparing TreeMap to EVT (EVT_NAME attribute)"
author: "Kori Blakenship and Randy Swaty"
date: "2022-02-28"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## The 80-80 Sankey chart

For this chart I filtered the TreeMap types first by "Dry" types as assigned by Randy and Kori, then by those that cover 80% of the western states then filtered the EVT types that cover 80% of those types.  Below the chart is the dataset used in the chart for your enjoyment/review. 

Hover over nodes to explore connections.  Node/band size represents relative amounts.  To get acres explore table below.
 
 <br>
 
**TREEMAP TYPES ON THE LEFT** ------------------------------------------------- **EVTs ON THE RIGHT**                               


```{r sankey80-80, echo=FALSE, fig.height=12, message=FALSE, warning=FALSE}

library(networkD3)
library(dplyr)
library(readr)


# read in snkyPdata
snkyPdata <- read_csv("data/sankey80-80.csv")

# remove decimals
snkyPdata$value <- round(snkyPdata$value)


# define nodes
nodes <- data.frame(
         name=c(as.character(snkyPdata$source), 
         as.character(snkyPdata$target)) %>% 
          unique())

# add source and target fields
snkyPdata$IDsource <- match(snkyPdata$source, nodes$name)-1 
snkyPdata$IDtarget <- match(snkyPdata$target, nodes$name)-1

# Make the Network
snkyP2 <- sankeyNetwork(Links = snkyPdata, 
                       Nodes = nodes,
                       Source = "IDsource", 
                       Target = "IDtarget",
                       Value = "value", 
                       NodeID = "name", 
                       width = 1100,
                       height = 1000, 
                       fontSize=16,
                       iterations = 0,
                       sinksRight=FALSE,
                       margin = 1)

snkyP2
```


## Data table

```{r sankey80-80data, echo=FALSE, message=FALSE, warning=FALSE}

DT80 <- read_csv("data/sankey80-80.csv")
library(DT)
datatable(DT80,
          colnames = c("TreeMap forest types",
                       "EVTs",
                       "Acres"),
          class = 'cell-border stripe')

```




